import{_ as L,r as m,n as le,o as w,c as U,a as t,F as re,j as oe,p as se,q as j,t as R,s as ae,k as G,i as H,h as a,v as ne,x as g,y as E,z as D,A as ie}from"./hJXOh39b.js";import{u as J}from"./CD1iowWI.js";const de=["onDragstart","onDrop"],ue=["onClick"],ce={key:0,class:"text-blue-500"},pe={key:1,class:"text-gray-400"},ge={__name:"TreeView",props:{nodes:{type:[Array,Object],required:!0},level:{type:Number,default:0}},emits:["node-click","node-reorder"],setup(I,{emit:f}){const l=I,k=m(new Set),N=f;let h=null,S=null;const O=(p,c)=>{h=p,S=c},A=(p,c)=>{h&&S!==null&&S!==c&&(l.nodes.splice(S,1),l.nodes.splice(c,0,h),N("node-reorder",l.nodes),h=null,S=null)},M=(p,c)=>{k.value.has(p)?k.value.delete(p):k.value.add(p),N("node-click",c)},T=p=>k.value.has(p),B=le(()=>Array.isArray(l.nodes)?l.nodes:[l.nodes]);return(p,c)=>{const P=K;return w(),U("div",null,[t("ul",null,[(w(!0),U(re,null,oe(a(B),(r,z)=>(w(),U("li",{draggable:"true",onDragstart:V=>O(r,z),onDragover:c[2]||(c[2]=j(()=>{},["prevent"])),onDrop:V=>A(r,z),key:r==null?void 0:r._id,style:se({paddingLeft:`${I.level*7}px`}),_class:"p-2 border mb-1 bg-gray-800 text-white rounded"},[t("div",{class:"flex items-center space-x-2 hover:bg-gray-100 p-1 rounded cursor-pointer",onClick:V=>M(r==null?void 0:r._id,r)},[r!=null&&r.children&&(r!=null&&r.children.length)?(w(),U("span",ce,R(T(r==null?void 0:r._id)?"-":"+"),1)):(w(),U("span",pe,"•")),t("span",{class:ae({"font-bold text-black":(r==null?void 0:r._type)==="folder","text-gray-700":(r==null?void 0:r._type)==="page"})},R(r==null?void 0:r.label),3)],8,ue),r!=null&&r.children&&(r!=null&&r.children.length)&&T(r==null?void 0:r._id)?(w(),G(P,{key:0,onNodeClick:c[0]||(c[0]=V=>N("node-click",V)),nodes:r==null?void 0:r.children,level:I.level+1,onNodeReorder:c[1]||(c[1]=V=>N("node-reorder",l.nodes))},null,8,["nodes","level"])):H("",!0)],44,de))),128))])])}}},K=L(ge,[["__scopeId","data-v-c355017c"]]),fe=()=>("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,I=>(I^crypto.getRandomValues(new Uint8Array(1))[0]&15>>I/4).toString(16)),be={class:"h-screen flex flex-col bg-gray-900 text-white"},me={class:"flex flex-1 overflow-hidden"},he={class:"w-64 bg-gray-100 p-1 border-r border-gray-300 hidden md:block"},ve={class:"flex-1 bg-gray-900 overflow-hidden flex flex-col"},ye={class:"ml-4"},xe=["disabled"],_e={class:"flex-1 overflow-auto p-4 bg-gray-900"},we={class:"mb-4"},ke={class:"mb-2"},Ne={class:"mb-4"},Se={class:"inline-flex"},$e=["disabled"],Ce=["disabled"],De=["disabled"],Ie={key:0},Ve={class:"mb-4"},Ue={class:"mb-4"},Te={class:"mb-4"},Ee={class:"mb-4"},Oe={class:"mb-4"},Be={class:"h-full"},Re={__name:"treeview",setup(I){m(null);let f=m();m();const l=m({_id:"",label:"",_slug:"",_image:"",children:[],content:""});m([]);const k=m("Mover"),N=m("Copiar");m(null);const h=m(""),S=m(0);let O="",A=m("metatags"),M=!1,T=!1,B=!1;const p=ne({loading:!1,message:"",async compileSite(){this.loading=!0,this.message="";try{alert(),(await(await fetch("/api/compileContent",{method:"POST"})).json()).success?this.message="Site compilado com sucesso!":this.message="Erro ao compilar o site."}catch(o){console.error("Erro:",o),this.message="Erro ao compilar o site."}finally{this.loading=!1}}}),c=o=>{A.value=o},P=()=>{r(f.value,l.value._id)&&F(f.value)};function r(o,e){function s(v,y){for(let x=0;x<v.length;x++){const _=v[x];if(_._id===y)return v.splice(x,1),!0;if(_.children&&_.children.length>0&&s(_.children,y))return!0}return!1}return s(o.children,e)}const z=()=>{T=!0,k.value="Selecione o destino"},V=()=>{B=!0,N.value="Selecione o destino"};function Q(o,e,s){function v(d,n){for(const i of d){if(i._path===n)return i;if(i.children&&i.children.length>0){const C=v(i.children,n);if(C)return C}}return null}function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){const n=Math.random()*16|0;return(d==="x"?n:n&3|8).toString(16)})}function x(d,n){d._id=y(),d._path=`${n}/${d._slug}`.replace("//","/"),d.children&&d.children.length>0&&d.children.forEach(i=>x(i,d._path))}function _(d,n){for(const i of d){if(i._path===n)return i;if(i.children&&i.children.length>0){const C=_(i.children,n);if(C)return C}}return null}const $=v(o.children,e);if(!$)return console.warn(`Nó de origem não encontrado: ${e}`),!1;const b=_(o.children,s);if(!b)return console.warn(`Nó de destino não encontrado: ${s}`),!1;b.children||(b.children=[]);const u=JSON.parse(JSON.stringify($));return x(u,b._path),b.children.push(u),!0}function W(o,e,s){function v(u,d){for(let n=0;n<u.length;n++){const i=u[n];if(i._path===d)return u.splice(n,1)[0];if(i.children&&i.children.length>0){const C=v(i.children,d);if(C)return C}}return null}function y(u,d){for(const n of u){if(n._path===d)return n;if(n.children&&n.children.length>0){const i=y(n.children,d);if(i)return i}}return null}function x(u,d){u._path=`${d}/${u._slug}`.replace("//","/"),u.children&&u.children.length>0&&u.children.forEach(n=>x(n,u._path))}function _(u){return JSON.parse(JSON.stringify(u))}const $=v(o.children,e);if(!$)return console.warn(`Nó de origem não encontrado: ${e}`),!1;const b=y(o.children,s);return b?(b.children||(b.children=[]),$.parentId=b._id,x($,b._path),b.children.push($),o.children=_(o.children),!0):(console.warn(`Nó de destino não encontrado: ${s}`),!1)}const F=async o=>{try{f.value=o,await $fetch("/api/save-nodes",{method:"POST",body:{nodes:o}}),console.log("Árvore salva com sucesso!")}catch(e){console.error("Erro ao salvar a árvore:",e)}},X=()=>{l.value._slug=l.value.label.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-"),M?l.value._path=(O+"/"+l.value._slug).replace("//","/"):l.value._path=ee(l.value._path)+"/"+l.value._slug.replace("//","/")},Y=async()=>{try{const o=await $fetch("/api/upsertNode",{method:"POST",body:{...l.value,content:h.value}});q()}catch(o){console.error("Erro ao enviar o nó:",o),alert("Erro ao enviar o nó.")}},Z=()=>{M=!0,O=l.value._path.replace("//","/"),l.value={_id:fe(),parentId:l.value._id,label:"",_path:O,_type:"page",_slug:"",content:"",children:[]},h.value=""},q=async()=>{try{const o=await $fetch("/api/nodes");f.value=await o,console.log(f.value)}catch(o){console.error("Failed to fetch JSON:",o)}};function ee(o){const e=o.replace(/\/$/,"").split("/");return e.pop(),e.join("/")}const te=async o=>{var e,s;if(T&&(T=!1,k.value="Mover",W(f.value,l.value._path,o._path)&&(F(f.value),console.log("Nó movido com sucesso!"))),B&&(B=!1,N.value="Copiar",Q(f.value,l.value._path,o._path)&&(F(f.value),console.log("Nó copiado com sucesso!"))),o!=null&&o._id){const{data:v}=await J("nodeDetails",()=>$fetch(`/api/getNode?_id=${o._id}`)),{data:y}=await J("recordDetails",()=>$fetch(`/api/getRecord?_id=${o._id}`));l.value={},l.value={...v.value.node,...(e=y.value)==null?void 0:e.data},h.value=(s=y.value)==null?void 0:s.data.content.replace(/\\n/g,`
`)}};return q(),(o,e)=>(w(),U("div",be,[e[22]||(e[22]=t("header",{class:"h-12 bg-gray-800 flex items-center px-4"},[t("div",{class:"text-lg"},"Círius")],-1)),t("div",me,[t("aside",he,[(w(),G(K,{key:a(S),nodes:a(f),onNodeClick:te,onNodeReorder:F},null,8,["nodes"]))]),t("main",ve,[t("div",ye,[t("button",{onClick:e[0]||(e[0]=s=>S.value++)},"Refresh"),t("button",{type:"button",onClick:e[1]||(e[1]=s=>c("metatags"))},"Metatags"),t("button",{onClick:e[2]||(e[2]=s=>c("content")),type:"button"},"Conteúdo"),t("button",{onClick:e[3]||(e[3]=(...s)=>a(p).compileSite&&a(p).compileSite(...s)),disabled:a(p).loading},R(a(p).loading?"Compilando...":"Compilar Site"),9,xe)]),t("div",_e,[t("form",{onSubmit:j(Y,["prevent"])},[g(t("div",we,[e[12]||(e[12]=t("label",{for:"_id",class:"block text-sm font-medium text-gray-200"},"ID",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a(l)._id=s),type:"text",id:"label",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[D,a(l)._id]])],512),[[E,!1]]),t("div",ke,[e[13]||(e[13]=t("label",{for:"label",class:"block text-sm font-medium text-gray-200"},"Label",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a(l).label=s),onInput:X,type:"text",id:"label",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,544),[[D,a(l).label]])]),t("div",Ne,[t("div",Se,[g(t("button",{class:"bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded-l",onClick:Z,type:"button"}," Novo ",512),[[E,a(l)._id]]),g(t("button",{class:"bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4",onClick:P,disabled:!a(l)._id,type:"button"}," Excluir ",8,$e),[[E,a(l)._id]]),g(t("button",{class:"bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4",onClick:z,disabled:!a(l)._id,type:"button"},R(a(k)),9,Ce),[[E,a(l)._id]]),g(t("button",{class:"bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded-r",onClick:V,disabled:!a(l)._id,type:"button"},R(a(N)),9,De),[[E,a(l)._id]])])]),a(A)==="metatags"?(w(),U("div",Ie,[t("div",Ve,[e[14]||(e[14]=t("label",{for:"label",class:"block text-sm font-medium text-gray-200"},"Slug",-1)),g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a(l)._slug=s),type:"text",id:"label",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[D,a(l)._slug]])]),t("div",Ue,[e[15]||(e[15]=t("label",{for:"type",class:"block text-sm font-medium text-gray-200"},"Tipo",-1)),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a(l)._type=s),type:"text",id:"type",maxlength:"20",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",required:""},null,512),[[D,a(l)._type]])]),t("div",Te,[e[16]||(e[16]=t("label",{for:"path",class:"block text-sm font-medium text-gray-200"},"Path",-1)),g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a(l)._path=s),type:"text",id:"path",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,a(l)._path]])]),t("div",Ee,[e[17]||(e[17]=t("label",{for:"image",class:"block text-sm font-medium text-gray-200"},"Image",-1)),g(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a(l)._image=s),type:"text",id:"image",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,a(l)._image]])]),g(t("div",Oe,[e[18]||(e[18]=t("label",{for:"type",class:"block text-sm font-medium text-gray-200"},"Parent_id",-1)),g(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a(l).parentId=s),type:"text",id:"type",maxlength:"20",class:"mt-1 block w-full bg-gray-800 text-white p-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,a(l).parentId]])],512),[[E,!1]])])):H("",!0),t("div",Be,[e[19]||(e[19]=t("label",{for:"type",class:"mb-2 block text-sm font-medium text-gray-200"},"Conteúdo",-1)),g(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=s=>ie(h)?h.value=s:null),class:"w-full h-full min-h-[250px] bg-gray-800 text-white border-none resize-none p-2 rounded"},null,512),[[D,a(h)]])]),e[20]||(e[20]=t("button",{type:"submit"},"Salvar",-1))],32)])]),e[21]||(e[21]=t("aside",{class:"w-64 bg-gray-100 p-1 border-r border-gray-300 hidden md:block"},null,-1))])]))}},ze=L(Re,[["__scopeId","data-v-e872c904"]]);export{ze as default};
